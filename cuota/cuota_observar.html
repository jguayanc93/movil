<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <title>CUOTA</title>
</head>
<body>
  <div class="my-4 mx-16">
    <a href="/main.html" class="flex items-center justify-center rounded-lg border border-transparent bg-indigo-600 px-6 py-3 text-xl 
    font-semibold text-white tracking-[.3em] shadow-xs hover:bg-indigo-700">MENU</a>
  </div>

  <div id="insertador-tipo" class="mx-6"></div>
  <div id="insertador-marca" class="mx-6"></div>
    
    <div>
        <p id="detallado"></p>
    </div>
    <div id="modal-aceptacion" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true"></div>
    <!--version compacta-->
    <div class="lg:flex lg:items-center lg:justify-between">
        <div class="min-w-0 flex-1">
          <!-- <div class="flex flex-row justify-center items-center gap-4">
            <p class="font-mono text-2xl font-bold tracking-tighter">Pick a Mes:</p>
            <input type="date" id="fecha-mes"
            class="w-32 p-2 border border-gray-600 rounded-md shadow-2xl focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
          </div> -->
          
          <div class="mt-1 flex flex-col sm:mt-0 sm:flex-row sm:flex-wrap sm:space-x-6">
            <!-- esta primera parte puede no ir debido a que no todos tiene una cuota establecida tener en cuenta -->
            <div class="h-24 flex flex-row justify-evenly">
              <div class="mt-2 flex items-center text-sm self-center">
                <svg class="mr-1.5 size-5 shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                  <path fill-rule="evenodd" d="m9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 .976.544l.062.029.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clip-rule="evenodd" />
                </svg>
                <p class="text-xl font-bold underline underline-offset-8 decoration-2">CUOTA</p>
              </div>
              <div class="mt-2 flex items-center text-sm text-gray-500 self-end">
              </div>
            </div>
            
          </div>          
        </div>
      </div>

    <div id="no-mostrar-jefaturas" class="my-4 mx-16">
      <a id="creacion" 
      class="flex items-center justify-center rounded-lg border border-transparent bg-rose-500 px-6 py-3 text-xl 
      font-semibold text-white tracking-[.3em] shadow-xs hover:bg-indigo-700" onclick="guardar_diferenciador()">REGISTRAR</a>
    </div>
    <div id="creacion-marca" class="my-4 mx-16"></div>

    <script src="/caminos/rutas.js"></script>
    <!-- <script src="./js/cuota/cuota.js"></script> -->
    <!-- <script src="../caminos/rutas.js"></script> -->
    <!-- <script src="../js/cuota/cuota.js"></script> -->
    <script>
      document.addEventListener("DOMContentLoaded",function(){
        if(document.getElementById("detallado")){ responder_revision_registro(); }
      })

      function responder_revision_registro(){

        let peticion = new Request(rutacuotarevisarregistro,{ method:"GET",mode:"cors",credentials:"include"})

        fetch(peticion)
        .then(resultado=>{
          if(!resultado.ok){
            throw new Error("ya tiene un registro para este mes");
          }
          return resultado.json();
        })
        .then(resultado=>{
          console.log("sin parsear",resultado)
          let direccion=Object.keys(resultado);
          if(Object.keys(resultado).includes("simple")){crear_plantilla_registro(resultado);}
          else if(Object.keys(resultado).includes("multiple")){document.getElementById("no-mostrar-jefaturas").innerHTML="";mostrar_marcas_asignadas(resultado["multiple"]);}
          else if(Object.keys(resultado).includes("superior")){console.log("aun falta esta parte")}
          // let decodificar = JSON.parse(resultado);
          // console.log("se trajo esta respuesta correcta",decodificar)          
        })
        .catch(err=>{
          console.log(err);
          
          let capa1=document.createElement('div');
          capa1.className="fixed inset-0 bg-gray-500/75 transition-opacity";
          capa1.setAttribute("aria-hidden","true");

          let capa2=document.createElement('div');
          capa2.className="fixed inset-0 z-10 w-screen overflow-y-auto";
          let capa3=document.createElement('div');
          capa3.className="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0";
          let capa4=document.createElement('div');
          capa4.className="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg";
          let capa5=document.createElement('div');
          capa5.className="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4";
          let capa6=document.createElement('div');
          capa6.className="sm:flex sm:items-start";
          let capa7=document.createElement('div');
          capa7.className="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left";
          let interior1=document.createElement('h3');
          interior1.className="text-base font-semibold text-gray-900";
          interior1.textContent=err;
          let interior2=document.createElement('div');
          interior2.className="mt-2";
    // let parrafo=document.createElement('p');
    // parrafo.className="text-sm text-gray-500";
    // parrafo.textContent=`Esta seguro que desea agregar este producto 12`;
    // let interior3=document.createElement('h3');
    // interior3.className="text-base font-semibold text-gray-900";
    // interior3.textContent="UNIDADES";
    // let interior4=document.createElement('div');
    // interior4.className="mt-2";
    // let parrafo2=document.createElement('input')
    // parrafo2.type="number";
    // parrafo2.id="cantidades";
    // parrafo2.className="inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-black shadow-xs hover:bg-red-500 sm:ml-3 sm:w-auto";
    // parrafo2.placeholder="ingresa la cantidad";
    // parrafo2.addEventListener('input',activar_boton_confirmacion)
    

    let parte2=document.createElement('div');
    parte2.className="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6";
    let boton1=document.createElement('button');
    boton1.className="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-red-500 sm:ml-3 sm:w-auto";
    boton1.setAttribute("type","button");
    boton1.disabled=false;
    boton1.textContent="OK";
    // boton1.id="producto-confirmado";
    boton1.addEventListener('click',revision_confirmacion)
    
    // let boton2=document.createElement('button');
    // boton2.className="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 shadow-xs ring-gray-300 ring-inset hover:bg-gray-50 sm:mt-0 sm:w-auto";
    // boton2.setAttribute("type","button");
    // boton2.textContent="OK";
    // boton2.addEventListener('click',cancelar_confirmacion)

    parte2.appendChild(boton1);
    // parte2.appendChild(boton2);

    // interior2.appendChild(parrafo);
    // interior4.appendChild(parrafo2);
    capa7.appendChild(interior1);
    capa7.appendChild(interior2);
    // capa7.appendChild(interior3);
    // capa7.appendChild(interior4);
    capa6.appendChild(capa7);
    capa5.appendChild(capa6);
    capa4.appendChild(capa5);
    capa4.appendChild(parte2);
    capa3.appendChild(capa4);
    capa2.appendChild(capa3);
    capa1.appendChild(capa2);

    document.getElementById("modal-aceptacion").appendChild(capa1);
    document.getElementById("modal-aceptacion").classList.remove('hidden');
        })
      }

      function revision_confirmacion(){
        window.location.assign('../main.html')
      }

      function crear_plantilla_registro(obj){

        let estilo_tipo = document.getElementById("insertador-tipo");
        estilo_tipo.innerHTML="";

        /////crea su estilo de tipo
        let contenedor_principal1=document.createElement("div");
        let princiapl1_label1=document.createElement("label");
        princiapl1_label1.className="block text-sm/6 font-medium text-gray-900";
        princiapl1_label1.textContent="Paso 1:";
        let princiapl1_label2=document.createElement("label");
        princiapl1_label2.className="block text-sm/6 font-medium underline underline-offset-4 text-gray-900";
        princiapl1_label2.textContent="Cuota de Mes Asignada";
        contenedor_principal1.appendChild(princiapl1_label1);
        contenedor_principal1.appendChild(princiapl1_label2);
        ///////contenedor 2
        let contenedor_principal2=document.createElement("div");
        contenedor_principal2.className="mt-2";

        let contenedor_principal2_contenedor1=document.createElement("div");
        contenedor_principal2_contenedor1.className="flex items-center rounded-md bg-white pl-3 outline-1 -outline-offset-1 outline-gray-300 has-[input:focus-within]:outline-2 has-[input:focus-within]:-outline-offset-2 has-[input:focus-within]:outline-indigo-600"

        let contenedor_principal2_contenedor2=document.createElement("div");
        contenedor_principal2_contenedor2.className="shrink-0 text-base text-gray-500 select-none sm:text-sm/6";
        contenedor_principal2_contenedor2.textContent="$";

        let monto_acordado=document.createElement("input");
        monto_acordado.id="vend-proyeccion";
        monto_acordado.type="number";
        monto_acordado.placeholder="0.00";
        monto_acordado.className="block min-w-0 grow py-1.5 pr-3 pl-1 text-base text-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6";

        let contenedor_principal3=document.createElement("div");
        contenedor_principal3.className="grid shrink-0 grid-cols-1 focus-within:relative";

        let selector_tipos=document.createElement("select");
        selector_tipos.id="currency"
        selector_tipos.name="currency"
        selector_tipos.ariaLabel="Currency"
        selector_tipos.className="col-start-1 row-start-1 w-full appearance-none rounded-md py-1.5 pr-7 pl-3 text-base text-gray-500 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6";
        let option1 = document.createElement("option");
        option1.value="USD";
        option1.textContent="USD";

        selector_tipos.appendChild(option1);

        contenedor_principal3.appendChild(selector_tipos)

        // contenedor_principal2_contenedor2.appendChild(monto_acordado);
        // contenedor_principal2_contenedor2.appendChild(selector_tipos);

        contenedor_principal2_contenedor1.appendChild(contenedor_principal2_contenedor2);
        contenedor_principal2_contenedor1.appendChild(monto_acordado);
        contenedor_principal2_contenedor1.appendChild(contenedor_principal3);

        contenedor_principal2.appendChild(contenedor_principal2_contenedor1);

        estilo_tipo.appendChild(contenedor_principal1)
        estilo_tipo.appendChild(contenedor_principal2)
      }

      function mostrar_marcas_asignadas(vendedor){
        let estilo_tipo = document.getElementById("insertador-tipo");
        estilo_tipo.innerHTML="";

        /////crea su estilo de tipo
        let contenedor_principal1=document.createElement("div");
        let princiapl1_label1=document.createElement("label");
        princiapl1_label1.className="block text-sm/6 font-medium text-gray-900";
        princiapl1_label1.textContent="Vendedor:";
        let princiapl1_label2=document.createElement("label");
        princiapl1_label2.className="block text-sm/6 font-medium underline underline-offset-4 text-gray-900";
        princiapl1_label2.textContent=vendedor["nombre"];
        contenedor_principal1.appendChild(princiapl1_label1);
        contenedor_principal1.appendChild(princiapl1_label2);
        ///////contenedor 2
        let contenedor3=document.createElement("div");
        let princiapl3_label1=document.createElement("label");
        princiapl3_label1.className="block text-sm/6 font-medium text-gray-900";
        princiapl3_label1.textContent="Tipo:";
        let princiapl3_label2=document.createElement("label");
        princiapl3_label2.className="block text-sm/6 font-medium underline underline-offset-4 text-gray-900";
        princiapl3_label2.textContent=vendedor["tipo"];
        contenedor3.appendChild(princiapl3_label1);
        contenedor3.appendChild(princiapl3_label2);

        estilo_tipo.appendChild(contenedor_principal1)
        estilo_tipo.appendChild(contenedor3)
        ///contenedor marcas
        for(const marc in vendedor["marcas"]){
          let contenedor_principal2=document.createElement("div");
          contenedor_principal2.className="mt-2";

          let contenedor_principal2_contenedor1=document.createElement("div");
          contenedor_principal2_contenedor1.className="flex items-center rounded-md bg-white pl-3 outline-1 -outline-offset-1 outline-gray-300 has-[input:focus-within]:outline-2 has-[input:focus-within]:-outline-offset-2 has-[input:focus-within]:outline-indigo-600"

          let boton_marca=document.createElement("div");
          boton_marca.className="my-4 mx-16";
          let enlace_marca=document.createElement("a");
          enlace_marca.className="flex items-center justify-center rounded-lg border border-transparent bg-rose-500 px-6 py-3 text-xl font-semibold text-white tracking-[.3em] shadow-xs hover:bg-indigo-700";
          enlace_marca.textContent=vendedor["marcas"][marc][1];
          enlace_marca.addEventListener("click",()=>habilitar_cuota_marca(marc,vendedor["marcas"][marc][0],vendedor["marcas"][marc][1]))

          boton_marca.appendChild(enlace_marca);
          contenedor_principal2_contenedor1.appendChild(boton_marca)
          contenedor_principal2.appendChild(contenedor_principal2_contenedor1);
          estilo_tipo.appendChild(contenedor_principal2);
        }


        // let contenedor_principal2=document.createElement("div");
        // contenedor_principal2.className="mt-2";

        // let contenedor_principal2_contenedor1=document.createElement("div");
        // contenedor_principal2_contenedor1.className="flex items-center rounded-md bg-white pl-3 outline-1 -outline-offset-1 outline-gray-300 has-[input:focus-within]:outline-2 has-[input:focus-within]:-outline-offset-2 has-[input:focus-within]:outline-indigo-600"

        // let contenedor_principal2_contenedor2=document.createElement("div");
        // contenedor_principal2_contenedor2.className="shrink-0 text-base text-gray-500 select-none sm:text-sm/6";
        // contenedor_principal2_contenedor2.textContent="$";

        // let monto_acordado=document.createElement("input");
        // monto_acordado.id="vend-proyeccion";
        // monto_acordado.type="number";
        // monto_acordado.placeholder="0.00";
        // monto_acordado.className="block min-w-0 grow py-1.5 pr-3 pl-1 text-base text-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6";

        // let contenedor_principal3=document.createElement("div");
        // contenedor_principal3.className="grid shrink-0 grid-cols-1 focus-within:relative";

        // let selector_tipos=document.createElement("select");
        // selector_tipos.id="currency"
        // selector_tipos.name="currency"
        // selector_tipos.ariaLabel="Currency"
        // selector_tipos.className="col-start-1 row-start-1 w-full appearance-none rounded-md py-1.5 pr-7 pl-3 text-base text-gray-500 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6";
        // let option1 = document.createElement("option");
        // option1.value="USD";
        // option1.textContent="USD";

        // selector_tipos.appendChild(option1);

        // contenedor_principal3.appendChild(selector_tipos)

        // contenedor_principal2_contenedor1.appendChild(contenedor_principal2_contenedor2);
        // contenedor_principal2_contenedor1.appendChild(monto_acordado);
        // contenedor_principal2_contenedor1.appendChild(contenedor_principal3);

        // contenedor_principal2.appendChild(contenedor_principal2_contenedor1);

        // estilo_tipo.appendChild(contenedor_principal1)
        // estilo_tipo.appendChild(contenedor3)
        // estilo_tipo.appendChild(contenedor_principal2)
      }

      function habilitar_cuota_marca(codigo,abreviatura,nombre){
        let estilo_tipo = document.getElementById("insertador-marca");
        estilo_tipo.innerHTML="";

        /////crea su estilo de tipo
        let contenedor_principal1=document.createElement("div");
        let princiapl1_label1=document.createElement("label");
        princiapl1_label1.className="block text-sm/6 font-medium text-gray-900";
        princiapl1_label1.textContent="Paso 1:";
        let princiapl1_label2=document.createElement("label");
        princiapl1_label2.className="block text-sm/6 font-medium underline underline-offset-4 text-gray-900";
        princiapl1_label2.textContent=`Cuota de Mes Asignada a ${nombre}`;
        contenedor_principal1.appendChild(princiapl1_label1);
        contenedor_principal1.appendChild(princiapl1_label2);
        ///////contenedor 2
        let contenedor_principal2=document.createElement("div");
        contenedor_principal2.className="mt-2";

        let contenedor_principal2_contenedor1=document.createElement("div");
        contenedor_principal2_contenedor1.className="flex items-center rounded-md bg-white pl-3 outline-1 -outline-offset-1 outline-gray-300 has-[input:focus-within]:outline-2 has-[input:focus-within]:-outline-offset-2 has-[input:focus-within]:outline-indigo-600"

        let contenedor_principal2_contenedor2=document.createElement("div");
        contenedor_principal2_contenedor2.className="shrink-0 text-base text-gray-500 select-none sm:text-sm/6";
        contenedor_principal2_contenedor2.textContent="$";

        let monto_acordado=document.createElement("input");
        monto_acordado.id="vend-proyeccion";
        monto_acordado.type="number";
        monto_acordado.placeholder="0.00";
        monto_acordado.className="block min-w-0 grow py-1.5 pr-3 pl-1 text-base text-gray-900 placeholder:text-gray-400 focus:outline-none sm:text-sm/6";

        let contenedor_principal3=document.createElement("div");
        contenedor_principal3.className="grid shrink-0 grid-cols-1 focus-within:relative";

        let selector_tipos=document.createElement("select");
        selector_tipos.id="currency"
        selector_tipos.name="currency"
        selector_tipos.ariaLabel="Currency"
        selector_tipos.className="col-start-1 row-start-1 w-full appearance-none rounded-md py-1.5 pr-7 pl-3 text-base text-gray-500 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6";
        let option1 = document.createElement("option");
        option1.value="USD";
        option1.textContent="USD";

        selector_tipos.appendChild(option1);

        contenedor_principal3.appendChild(selector_tipos)

        contenedor_principal2_contenedor1.appendChild(contenedor_principal2_contenedor2);
        contenedor_principal2_contenedor1.appendChild(monto_acordado);
        contenedor_principal2_contenedor1.appendChild(contenedor_principal3);

        contenedor_principal2.appendChild(contenedor_principal2_contenedor1);

        estilo_tipo.appendChild(contenedor_principal1)
        estilo_tipo.appendChild(contenedor_principal2)
        /////esto es solo para permitir el registro de una cuota de una marca especifica

        let marca_tipo = document.getElementById("creacion-marca");
        let enlace_para_guardar=document.createElement("a");
        enlace_para_guardar.className="flex items-center justify-center rounded-lg border border-transparent bg-rose-500 px-6 py-3 text-xl font-semibold text-white tracking-[.3em] shadow-xs hover:bg-indigo-700";
        enlace_para_guardar.textContent="REGISTRAR";
        enlace_para_guardar.addEventListener("click",()=>{guardar_cuota_de_marca(codigo,abreviatura)})
        marca_tipo.appendChild(enlace_para_guardar);
      }


      function guardar_diferenciador(){

        let diferenciador = document.getElementById("vend-proyeccion");
        console.log("este es el seleccionado: ",diferenciador.value);

        const cuerpo={ 'fijado':diferenciador.value}
        const bodystring=JSON.stringify(cuerpo);

        if(parseFloat(diferenciador.value)>1){

          let peticion = new Request(rutacuotaregistro,{ method:"POST",headers:{'Content-Type':'application/json'},body:bodystring,mode:"cors",credentials:"include"})

          fetch(peticion)
          .then(resultado=>{
            if(!resultado.ok){
              throw new Error("fallo en el registro de la cuota mensual");
            }
            return resultado.json();
          })
          .then(resultado=>{
            // let decodificar = JSON.parse(resultado);
            // console.log(decodificar)
            window.location.assign("https://landing.compudiskett.com.pe/main.html")
          })
          .catch(err=>{
            console.log(err);
          })
        }
      }

      function guardar_cuota_de_marca(codigo,abreviatura){

        let diferenciador = document.getElementById("vend-proyeccion");
        console.log("este es el seleccionado: ",diferenciador.value);

        const cuerpo={
          'fijado':diferenciador.value,
          'codigo':codigo,
          'recortado':abreviatura
        }
        const bodystring=JSON.stringify(cuerpo);

        if(parseFloat(diferenciador.value)>1){

          let peticion = new Request(rutacuotaregistromarcaseleccionada,{ method:"POST",headers:{'Content-Type':'application/json'},body:bodystring,mode:"cors",credentials:"include"})

          fetch(peticion)
          .then(resultado=>{
            if(!resultado.ok){
              throw new Error("fallo en el registro de la cuota mensual");
            }
            return resultado.json();
          })
          .then(resultado=>{
            // let decodificar = JSON.parse(resultado);
            // console.log(decodificar)
            window.location.assign("https://landing.compudiskett.com.pe/main.html")
          })
          .catch(err=>{
            console.log(err);
          })
        }
      }
    </script>
</body>
</html>